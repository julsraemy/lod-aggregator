# Test run with the Greek ecc-books dataset

Canonical URL of the dataset: http://www.semantics.gr/authorities/vocabularies/ecc-books-dataset 

## Downloading the dataset description using the crawler tool:

The crawler fails currently for this URL. The command to only download the dataset description would be:

```bash
docker-compose run --rm --user 1000:1000 crawler /bin/bash ./crawler.sh   \
  -dataset_uri http://www.semantics.gr/authorities/vocabularies/ecc-books-dataset  \
  -dataset_description_only \
  -output_file /opt/data/ecc-books-dataset-description.nt
```

Instead we used the following work around to download the complete dataset (including the dataset description).
The following 'curl' command was run in the home dir of the lod-aggregator:

```bash
curl -H "Accept: application/rdf+xml" \
     https://www.semantics.gr/authorities/vocabularies/ecc-books-dataset \
     > ./data/ecc-books-dataset.rdf
```

## Validating the dataset description

Before processing the complete data we validated the dataset description. We used a SHACL shape file defined for datasets with URI lists described using VOID:  

```bash
docker-compose run --rm --user 1000:1000 validate starter.sh \
  --data ecc-books-dataset.rdf \
  --shape shacl_dataset_list_void.ttl \
  --output gr_validate_dataset.ttl
```

The validation was succesful, the file gr_validate_dataset.ttl had the following content:

```bash
@prefix rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix sh:    <http://www.w3.org/ns/shacl#> .
@prefix xsd:   <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs:  <http://www.w3.org/2000/01/rdf-schema#> .

[ a            sh:ValidationReport ;
  sh:conforms  true
] .
```

## Mapping the schema.org data to EDM data

Next step is doing the actual conversion of the resources, the source has several schema classes that need to be processed seperately.

### Start with the object descriptions

```bash
docker-compose run --rm --user 1000:1000 map starter.sh \
  --data ecc-books-dataset.rdf \
  --query gr_book.rq \
  --format N-Triples \
  --output ecc-books-cho-edm.nt
```

We asked for a resultset in N-Triples so we can easily merge all the output files into one data file.

### The same for the person descriptions

```bash
docker-compose run --rm --user 1000:1000 map starter.sh \
  --data ecc-books-dataset.rdf \
  --query gr_person.rq \
  --format N-Triples \
  --output ecc-books-person-edm.nt
```

### The same for the organizaton description

```bash
docker-compose run --rm --user 1000:1000 map starter.sh \
  --data ecc-books-dataset.rdf \
  --query gr_person.rq \
  --format N-Triples \
  --output ecc-books-person-edm.nt
```

### And the last one, the place descriptions

```bash
docker-compose run --rm --user 1000:1000 map starter.sh \
  --data ecc-books-dataset.rdf \
  --query gr_place.rq \
  --format N-Triples \
  --output ecc-books-place-edm.nt
```

## Merge into one result file

For further processing a single data file is easier to handle. This can be done with an standard `cat` command:

```bash
cat data/ecc-books-cho-edm.nt \
    data/ecc-books-person-edm.nt \
    data/ecc-books-organization-edm.nt \
    data/ecc-books-place-edm.nt \
    > data/ecc-books-edm.nt
```

## Validate the total the EDM data

Currently we only have a validation for the ProvidedCHO and AggregatedCHO classes:

```bash
docker-compose run --rm --user 1000:1000 validate starter.sh \
  --data ecc-books-edm.nt \
  --shape shacl_cho_edm.ttl \
  --output gr_validate_cho.ttl
```

This resulted in the following errors for all the CHO resources.

+ "missing value for edm:dataProvider"
+ "missing or invalid dc:rights value"

## Serialize the EDM to RDF/XML format

With a succesful validation the next step would be to convert the result to RDF/XML in so it can be processed by Europeana

```bash
docker-compose run --rm --user 1000:1000 serialize starter.sh \
  --data ecc-books-edm.nt \
  --format RDF/XML \
  --output ecc-books-edm.rdf
```

The files generated by this test run are stored in the test dir under gr_ecc-books.
